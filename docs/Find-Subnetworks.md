---
title: Find Subnetworks


The **Find Subnetworks** tool finds all disconnected networks within a polyline shapefile, and labels all stream 
features within each disconnected network with a unique identifier code.  The tool assumes that the input stream network
is (or is derived from) a USGS NHD dataset. In addition, the tool can optionally find topological errors within the 
input network, including:

* Duplicate reaches
* Confluence errors
* Multiple outflows

**Illustrated examples of topographic error**

| Feature Type            | Example                                                                      |
| ----------------------- | -----------------------------------------------------------------------------|
| Duplicate reaches       | ![error_duplicate]({{site.baseurl}}/images/error_dupe.png)                   |
| Confluence errors       | ![error_confluence]({{site.baseurl}}/images/error_conf.png)                  |
| Multiple outflows       | ![error_outflow]({{site.baseurl}}/images/error_out.png)                      |
__________________________________________________________________________________________________________

## Usage

### Requirements

* ArcGIS version 10.4 or higher
* GDAL: The [Geospatial Data Abstraction Library](https://www.gdal.org) is required by this tool, in order 
to directly convert between shapefiles and NetworkX graphs. Because GNAT users will most likely be operating in a Windows 
environment, we strongly recommend that the user installs GDAL separately using the Windows binaries offered by 
Tamas Szekeres at [GISInternals](http://www.gisinternals.com/). Detailed instructions for installing the GDAL binaries
area available [here](#).

### Input Parameters

![find_subnetworks_form]({{site.baseurl}}/images/find_subnetworks_form.PNG)

**Input stream network shapefile**

Stream network shapefile representing a drainage network. Ideally this network should be a USGS NHD flowline
dataset, or derived from NHD. Also, all canal features (i.e. FCode = 336) must be removed prior to running the tool.
Removing canal features will create disconnected subnetworks within the overall stream network, each of which will be 
assigned a unique identifier code by the tool.

### Outputs

**Output shapefile**

The stream network polyline feature class, which will include new attribute fields generated by the tool. The new attribute
fields include:

* `_FID_` : unique identifier for each line feature
* `_netid_` : unique identifier for each subnetwork

**Find topology errors (optional)**

If this option is selected, the **Find Subnetworks** tool will also attempt to find and label topological errors. New 
attribute fields will be added to the output shapfile, including:
* `_err_dupe_` : boolean value indicates if the line feature is a duplicate of another feature (based on calculate length).
* `_err_conf_` : boolean value indicates if the line feature has an upstream flow direction.
* `_err_out_` : boolean indicates either a problem with flow direction (multiple reachs flowing to the same node) or a
subnetwork where the number of outflow features != 0.

_______________________________________________________________
## Technical Background

### Calculation Method

The **Find Subnetworks** tool relies on the excellent [NetworkX](https://networkx.github.io/documentation/networkx-1.11/) 
python library, which is in turn based on concepts from [graph theory](https://en.wikipedia.org/wiki/Graph_theory). 
This tool converts the input stream network shapefile into a graph object, which is how the file is then processed 
throughout the workflow, until being converted back into a shapefile.

### Post-processing

![find_subnetworks_output]({{site.baseurl}}/images/find_subnetworks_output.PNG)

After the **Find Subnetworks** tool is finished processing, the user should decide which subnets should remain disconnected
from the main network, and which should be edited so that they are connected. Subnets can be visualized using the `_netdid_`
attribute field. In addition, the location of topological errors within the subnetworks can be ascertained by symbolizing 
the `_err_dupe_`, `_err_conf_`, and `_err_out` attribute fields in the output shapefile. The user can then utilize ArcMap 
editing tools to manual edit these features if they are actual topological errors.

This process can then be repeated by running the repaired stream network shapefile through the **Find Subnetworks** tool 
to find any missed errors. 

### Troubleshooting and Potential Issues

The user should use caution when reviewing reaches where an error is indicated (e.g. `_err_conf_ = 1`). Adjacent and/or 
nearby stream reach features should also be examined.